---
title: "Reproducible Research - Peer Assessment Project No. 1"
output: 
  html_document:
    keep_md: true
    
---

```{r Setup}
rm(list=ls())
options(stringsAsFactors = FALSE)
Sys.setlocale("LC_TIME", "English")

if (!is.element("ggplot2",installed.packages()) ) {install.packages("ggplot2")}
library(ggplot2)

```


##      Loading and Preprocessing the Data

```{r Loading Data}

if (!file.exists("activity.csv")) {unzip("activity.zip")}

dataAct<-read.csv("activity.csv")

```


##      Mean Total Number of Steps Taken Per Day
```{r Mean per Day}
dailyData <-data.frame(date=character(length(levels(as.factor( dataAct$date)))))
dailyData$date<-unique(dataAct$date)
dailyData$tot<-tapply(dataAct$steps,dataAct$date,sum,na.rm=TRUE)

##      Histogram of the total number of steps taken per day
q<- qplot(dailyData$tot,col="red")
print(q)

##      The mean and median of the total number of steps taken per day     

dailyData$mean<-tapply(dataAct$steps,dataAct$date,mean,na.rm=TRUE)
dailyData$median<-tapply(dataAct$steps,dataAct$date,median)

```
The mean of the number of steps taken per day  is
`r print(dailyData$mean)`  
The median of the number of steps taken per day  is 
`r print(dailyData$median)`  

## The Average Daily Activity Pattern
```{r Daily Activity Pattern}

##    compute the plot
##

avInterval<-tapply(dataAct$steps,as.factor(dataAct$interval),mean,na.rm=TRUE)


tmp<-cbind(levels(factor(dataAct$interval)),avInterval)
plot (tmp[,1],tmp[,2],type="l",main="Daily Average no.of Steps per Time Interval",
      ylab="Av. no. of Steps",xlab="Time Interval")

##      Which 5-minute interval, on average across all the days in the dataset, 
##      contains the maximum number of steps?

maxNoSteps<-max(as.numeric(tmp[,2]))
intervalofMax<-tmp[match(maxNoSteps,tmp[,2]),1]
intervalofMax


```

The time of day of the interval with maximum avergae steps is `r intervalofMax`  

## Calculate and Report the Total Number of Missing Values in the Dataset

```{r Calculate no. of  missing values}

naVec<-apply(as.matrix(dataAct), 2, function(x) sum(is.na(x)))
naVec[1]
```
total number of missing cases is `r naVec[1]`  

The strategy of replacing NA's is to use the average for that day, unless all  
the values of the day are NA,s. Than it is replaced by 0.
```{r Filling missing values }
##      Filling in all of the missing values in the dataset.
##      Using the average for that day, 
##      replicate the data into clean data frame
cleanDataAct<-dataAct
#cleanDataAct$date<-as.factor(cleanDataAct$date)

##      Calculate daily average
##      
dailyData$av <- tapply(dataAct$steps,as.factor(dataAct$date),mean,na.rm=TRUE)
##      if the average column contains NA's it is because the input to the mean function us all NA's.
##      In that case it should be 0 as the total function
dailyData$av[is.na(dailyData$av)]<-0

##      Calculate the indices of NA values in steps vector

naInd<-which(is.na(cleanDataAct$steps))
a<-cleanDataAct$date[naInd]
cleanDataAct$steps[naInd]<-dailyData$av[cleanDataAct$date[naInd]]


##     Make a histogram of the total number of steps taken each day and
##     __________________________________________________________________
##     
dailyData$totClean<-tapply(cleanDataAct$steps,cleanDataAct$date,sum)
q<-qplot(dailyData$totClean,fill="red")
print(q)

##     The mean and median total number of steps taken per day
##     __________________________________________________________

dailyData$meanClean<-tapply(cleanDataAct$steps,cleanDataAct$date,mean)
dailyData$medianClean<-tapply(cleanDataAct$steps,cleanDataAct$date,median)

print(dailyData$meanClean)
print(dailyData$medianClean)


```

The mean of the clean data is `r dailyData$meanClean`  
The median of the clean data is `r dailyData$medianClean` 

```{r difference of values without NA}

##     Do these values differ from the estimates from the first part of the 
##     assignment? 
##     ______________________________________________________________________

dailyData$meanDIff<- dailyData$meanClean - dailyData$mean
dailyData$medianDiff<- dailyData$medianClean - dailyData$median

print(dailyData$meanDIff)
print(dailyData$medianDiff)
```
The difference of the mean without NA's is `r dailyData$meanDIff`   
The difference of the median without NA's is `r dailyData$medianDIff`
```{r difference of total}
##     What is the impact of inputing missing data on the 
##     estimates of the total daily number of steps? 
## 
dailyData$totDIff<- dailyData$totClean - dailyData$tot
print(dailyData$totDIff)
```
The impact of inputing missing data on the total daiky estimates is   
`r dailyData$totDIff`

## Differences in Activity Patterns Between Weekdays and Weekends  

```{r difference of Activit of weekend and weekdays}

##      Create a new factor variable in the dataset with two levels
##       – “weekday” and “weekend” indicating whether a given date is a weekday
##        or weekend day.
##________________________________________________________________
##

wkedays<-c("Sat","Sun")
cleanDataAct$dayType<-
        match(weekdays(as.Date(cleanDataAct$date,
                        format = "%d/%m/%Y"),abbreviate=TRUE),wkedays,nomatch = 3)

cleanDataAct$dayType<-as.character(cleanDataAct$dayType)
cleanDataAct$dayType<-gsub("1","weekend",cleanDataAct$dayType,fixed = TRUE)
cleanDataAct$dayType<-gsub("2","weekend",cleanDataAct$dayType,fixed = TRUE)
cleanDataAct$dayType<-gsub("3","weekday",cleanDataAct$dayType,fixed = TRUE)
cleanDataAct$dayType<-as.factor(cleanDataAct$dayType)

levels(cleanDataAct$dayType)

## Make a panel plot containing a time series plot (i.e. type = "l") 
## of the 5-minute interval (x-axis) and the average number of steps taken, 
## averaged across all weekday days or weekend days (y-axis).
## ____________________________________________________________________________ 
## See the README file in the GitHub repository to see an example of what this plot
##  should look like using simulated data.

#prepare dataframe cleanAV for plotting use auxiliary cleanAve
cleanAv<-data.frame(interval=integer
                    (length(levels(as.factor( cleanDataAct$interval)))))
cleanAv$interval<-levels(factor(cleanDataAct$interval))
cleanAv$wType<-as.factor("weekday")
cleanAve<-data.frame(interval=integer
                    (length(levels(as.factor( cleanDataAct$interval)))))
cleanAve$interval<-levels(factor(cleanDataAct$interval))
cleanAve$wType<-as.factor("weekend")

#prepare weekday data for ploting in cleanAv dataframe
df<-data.frame(wSteps=
       numeric(length(which(cleanDataAct$dayType == "weekday"))))
df$wSteps<-cleanDataAct$steps[which(cleanDataAct$dayType=="weekday")]
df$wInterval<-cleanDataAct$interval[which(cleanDataAct$dayType=="weekday")]

cleanAv$av<-tapply(df$wSteps,as.factor(df$wInterval),mean,na.rm=TRUE)


#prepare weekend data for ploting in auxiliary
de<-data.frame(wSteps=
                       numeric(length(which(cleanDataAct$dayType == "weekend"))))
de$wSteps<-cleanDataAct$steps[which(cleanDataAct$dayType=="weekend")]
de$wInterval<-cleanDataAct$interval[which(cleanDataAct$dayType=="weekend")]

cleanAve$av<-tapply(de$wSteps,as.factor(de$wInterval),mean,na.rm=TRUE)

cleanAv<-rbind(cleanAv, cleanAve)


# plot
# 


q<-qplot(interval, av, data=cleanAv, geom = "density" , color="red",fill="green",
      facets = wType~.,binwidth = 2, xlab="Interval", ylab="Number of Steps")

print(q)      


```